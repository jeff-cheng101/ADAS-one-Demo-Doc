# ç ”ç©¶ AI Gateway ç­†è¨˜

## è³‡è¨Šé€£çµï¼š
- https://github.com/Portkey-AI/gateway
- https://github.com/Portkey-AI/gateway/blob/main/.github/README.cn.md#supported-sdks
- https://drive.google.com/file/d/11X2SbmKVwGkPHudrbkVKHC9FN4xuSL7a/view?usp=sharing
- https://codewiki.google/github.com/portkey-ai/gateway#ai-gateway-core-functionality

- https://github.com/helicone/helicone


## é–‹æºç‰ˆå’Œä»˜è²»ç‰ˆæœ¬çš„å·®ç•°

Portkey AI Gateway çš„ **é–‹æºç‰ˆæœ¬** ï¼ˆOpen Sourceï¼‰èˆ‡ **ä»˜è²»ç‰ˆæœ¬** ï¼ˆåŒ…å« Enterprise ä¼æ¥­ç‰ˆèˆ‡ Hosted é›²ç«¯è¨—ç®¡ç‰ˆï¼‰åœ¨åŠŸèƒ½æ¬Šé™ã€å®‰å…¨æ€§ã€ç®¡ç†èƒ½åŠ›åŠæ”¯æ´æœå‹™ä¸Šæœ‰é¡¯è‘—å·®ç•°ã€‚

ä»¥ä¸‹æ˜¯å…©è€…çš„è©³ç´°å°æ¯”ï¼š

1\. æ ¸å¿ƒåŠŸèƒ½èˆ‡é€²éšå·¥å…·

-  **é–‹æºç‰ˆæœ¬ï¼š**  æä¾›åŸºç¤ä¸”é«˜æ•ˆçš„ AI ç¶²é—œåŠŸèƒ½ï¼ŒåŒ…æ‹¬æ”¯æ´è¶…é 250 ç¨®å¤§å‹èªè¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„è·¯ç”±ã€è‡ªå‹•é‡è©¦ï¼ˆRetriesï¼‰ã€å›é€€æ©Ÿåˆ¶ï¼ˆFallbacksï¼‰ã€è² è¼‰å‡è¡¡ï¼ˆLoad Balancingï¼‰ä»¥åŠåŸºç¤çš„ Guardrails é˜²è­·,,ã€‚

-  **ä»˜è²»ç‰ˆæœ¬ï¼ˆHosted/Enterpriseï¼‰ï¼š**  æä¾›æ›´å¼·å¤§çš„ç®¡ç†å·¥å…·ï¼Œä¾‹å¦‚ï¼š

â—¦  **èªç¾©å¿«å–ï¼ˆSemantic Cachingï¼‰ï¼š**  é™¤äº†ç°¡å–®å¿«å–å¤–ï¼Œä»˜è²»ç‰ˆæ”¯æ´èªç¾©å¿«å–ï¼Œèƒ½æ›´è°æ˜åœ°ç¯€çœæˆæœ¬ä¸¦é™ä½å»¶é²,ã€‚

â—¦  **æç¤ºè©ç¯„æœ¬ç®¡ç†ï¼ˆPrompt Managementï¼‰ï¼š**  æä¾›é€šç”¨çš„æç¤ºè©éŠæ¨‚å ´ï¼ˆPlaygroundï¼‰ï¼Œæ”¯æ´æç¤ºè©çš„ç‰ˆæœ¬ç®¡ç†èˆ‡å”ä½œ,ã€‚

â—¦  **æ—¥èªŒèˆ‡è§€æ¸¬æ€§ï¼ˆLogging & Observabilityï¼‰ï¼š**  é‡å° Agent æ¡†æ¶æä¾›å®Œæ•´çš„æ—¥èªŒç´€éŒ„ã€è¿½è¹¤èˆ‡è§€æ¸¬åŠŸèƒ½ã€‚

â—¦  **ä¾›æ‡‰å•†å„ªåŒ–ï¼ˆProvider Optimizationï¼‰ï¼š**  æ ¹æ“šä½¿ç”¨æ¨¡å¼è‡ªå‹•åˆ‡æ›è‡³æˆæœ¬æ•ˆç›Šæœ€é«˜çš„ä¾›æ‡‰å•†ã€‚

2\. å®‰å…¨æ€§èˆ‡åˆè¦æ€§

-  **é–‹æºç‰ˆæœ¬ï¼š**  é›–ç„¶å…·å‚™åŸºç¤çš„ Guardrails å’Œé‡‘é‘°ç®¡ç†ï¼Œä½†æ›´é€²éšçš„å®‰å…¨æ§ç®¡ä¸»è¦é›†ä¸­åœ¨ä»˜è²»ç‰ˆã€‚

-  **ä»˜è²»ç‰ˆæœ¬ï¼ˆEnterpriseï¼‰ï¼š**

â—¦  **éš±ç§æ•¸æ“šè„«æ•ï¼ˆPII Redactionï¼‰ï¼š**  è‡ªå‹•å¾è«‹æ±‚ä¸­ç§»é™¤æ•æ„Ÿæ•¸æ“šï¼Œé˜²æ­¢è³‡è¨Šå¤–æ´©ã€‚

â—¦  **å­˜å–æ§åˆ¶èˆ‡å…¥ç«™è¦å‰‡ï¼š**  å¯æ ¹æ“š IP æˆ–åœ°ç†ä½ç½®ï¼ˆGeoï¼‰é™åˆ¶é€£ç·šã€‚

â—¦  **ä¼æ¥­ç´šåˆè¦ï¼š**  ç¬¦åˆ  **SOC2ã€ISOã€HIPAAã€GDPR åŠ CCPA**  ç­‰åœ‹éš›å®‰å…¨èˆ‡æ•¸æ“šéš±ç§è¦ç¯„,ã€‚

3\. éƒ¨ç½²èˆ‡ç®¡ç†

-  **é–‹æºç‰ˆæœ¬ï¼š**  æ¡ç”¨ MIT æˆæ¬Šï¼Œå¯æ–¼æœ¬åœ°ï¼ˆNode.js/npmï¼‰æˆ– Docker ç’°å¢ƒå¿«é€Ÿéƒ¨ç½²,,ã€‚

-  **ä»˜è²»ç‰ˆæœ¬ï¼ˆEnterpriseï¼‰ï¼š**  æ”¯æ´åœ¨  **AWSã€Azureã€GCPã€OpenShift æˆ– Kubernetes**  ç­‰ç§æœ‰é›²ç’°å¢ƒé€²è¡Œéƒ¨ç½²ã€‚æ­¤å¤–ï¼Œé‚„åŒ…å«é€²éšçš„**çµ„ç¹”ç®¡ç†ï¼ˆOrg managementï¼‰**èˆ‡æ²»ç†åŠŸèƒ½ï¼Œæ–¹ä¾¿å¤§è¦æ¨¡åœ˜éšŠä½¿ç”¨ã€‚

4\. æŠ€è¡“æ”¯æ´

-  **é–‹æºç‰ˆæœ¬ï¼š**  ä¸»è¦é€éç¤¾ç¾¤è«–å£‡ã€GitHub Issues ä»¥åŠæ¯é€±äº”çš„ç¤¾ç¾¤é€šè©±ï¼ˆCommunity Callsï¼‰ç²å–æ”¯æ´,,ã€‚

-  **ä»˜è²»ç‰ˆæœ¬ï¼š**  æä¾› **å°ˆæ¥­æŠ€è¡“æ”¯æ´ï¼ˆProfessional Supportï¼‰** ã€24/7 é ‚ç´šæ”¯æ´æœå‹™ï¼Œä¸¦äº«æœ‰åŠŸèƒ½çš„å„ªå…ˆé–‹ç™¼æ¬Š,ã€‚

---

## è©³ç´°åŠŸèƒ½æ¸…å–®åŠå·®ç•°

### Portkey AI Gateway çš„åŠŸèƒ½å¯åŠƒåˆ†ç‚ºæ ¸å¿ƒåŠŸèƒ½ï¼ˆé–‹æºç‰ˆå¯ç”¨ï¼‰ä»¥åŠé€²éšåŠŸèƒ½ï¼ˆé›²ç«¯è¨—ç®¡ç‰ˆèˆ‡ä¼æ¥­ç‰ˆå°ˆå±¬ï¼‰ã€‚
### ä»¥ä¸‹æ˜¯è©³ç´°çš„åŠŸèƒ½æ¸…å–®å°ç…§ï¼š

1\. æ ¸å¿ƒè·¯ç”±èˆ‡å¯é æ€§ (Reliability)

æ­¤é¡åˆ¥å¤šæ•¸åŠŸèƒ½åœ¨é–‹æºç‰ˆä¸­å‡æœ‰æä¾›ï¼Œæ—¨åœ¨ç¢ºä¿ AI è«‹æ±‚çš„ç©©å®šæ€§ã€‚

| åŠŸèƒ½é …ç›® | é–‹æºç‰ˆ (Open Source) | é›²ç«¯ç‰ˆ / ä¼æ¥­ç‰ˆ (Hosted / Enterprise) |
| --- | --- | --- |
| **æ”¯æ´ LLM æ•¸é‡** | 250+ ç¨®æ¨¡å‹ | 250+ ç¨®æ¨¡å‹ |
| **è‡ªå‹•é‡è©¦ (Retries)** | âœ… (æœ€é«˜ 5 æ¬¡) | âœ… |
| **å›é€€æ©Ÿåˆ¶ (Fallbacks)** | âœ… | âœ… |
| **è² è¼‰å‡è¡¡ (Load Balancing)** | âœ… | âœ… |
| **è«‹æ±‚è¶…æ™‚ç®¡ç† (Timeouts)** | âœ… | âœ… |
| **å¤šæ¨¡æ…‹èˆ‡å¯¦æ™‚ API æ”¯æ´** | âœ… | âœ… |
| **ä¾›æ‡‰å•†è‡ªå‹•å„ªåŒ–** | âŒ | **âœ… (æ ¹æ“šæˆæœ¬/æ•ˆèƒ½è‡ªå‹•åˆ‡æ›)** |

2\. æ•ˆèƒ½èˆ‡æˆæœ¬æ§ç®¡ (Cost & Performance)

ä»˜è²»ç‰ˆæœ¬åœ¨ç¯€çœæˆæœ¬èˆ‡å¤§è¦æ¨¡ç®¡ç†ä¸Šå…·å‚™æ›´å¼·çš„æŠ€è¡“ã€‚

| åŠŸèƒ½é …ç›® | é–‹æºç‰ˆ (Open Source) | é›²ç«¯ç‰ˆ / ä¼æ¥­ç‰ˆ (Hosted / Enterprise) |
| --- | --- | --- |
| **åŸºç¤å¿«å– (Simple Caching)** | âœ… | âœ… |
| **èªç¾©å¿«å– (Semantic Caching)** | âŒ | **âœ… (åŸºæ–¼èªç¾©ç›¸ä¼¼åº¦è§¸ç™¼)** |
| **ä½¿ç”¨é‡åˆ†æ (Usage Analytics)** | âœ… (åŒ…å«æˆæœ¬ã€å»¶é²ç›£æ§) | âœ… |
| **æç¤ºè©ç¯„æœ¬ç®¡ç† (Prompt Mgmt)** | âŒ | **âœ… (åŒ…å«ç‰ˆæœ¬ç®¡ç†èˆ‡éŠæ¨‚å ´)** |

3\. å®‰å…¨æ€§èˆ‡åˆè¦æ€§ (Security & Compliance)

ä¼æ¥­ç‰ˆæä¾›äº†æ›´åš´æ ¼çš„æ•¸æ“šæ²»ç†èˆ‡éš±ç§ä¿è­·å·¥å…·ã€‚

| åŠŸèƒ½é …ç›® | é–‹æºç‰ˆ (Open Source) | é›²ç«¯ç‰ˆ / ä¼æ¥­ç‰ˆ (Hosted / Enterprise) |
| --- | --- | --- |
| **AI é˜²è­·æ¬„ (Guardrails)** | âœ… (50+ ç¨®) | âœ… |
| **è™›æ“¬é‡‘é‘°ç®¡ç†** | âœ… | âœ… |
| **è§’è‰²æ¬Šé™æ§åˆ¶ (RBAC)** | âš ï¸ (åŸºç¤) | **âœ… (é€²éšçµ„ç¹”èˆ‡å·¥ä½œå€ç®¡ç†)** |
| **éš±ç§æ•¸æ“šè„«æ• (PII Redaction)** | âŒ | **âœ… (è‡ªå‹•ç§»é™¤æ•æ„Ÿè³‡è¨Š)** |
| **å…¥ç«™è¦å‰‡ (Inbound Rules)** | âŒ | **âœ… (IP èˆ‡åœ°ç†ä½ç½®é€£ç·šé™åˆ¶)** |
| **åœ‹éš›åˆè¦èªè­‰** | éƒ¨åˆ†æ”¯æ´ | **âœ… (SOC2, ISO, HIPAA, GDPR, CCPA)** |

4\. AI Agent è§€æ¸¬èˆ‡ç®¡ç†

é‡å°è¤‡é›œçš„ Agent å·¥ä½œæµï¼Œä»˜è²»ç‰ˆæä¾›æ·±åº¦çš„è¿½è¹¤èƒ½åŠ›ã€‚

| åŠŸèƒ½é …ç›® | é–‹æºç‰ˆ (Open Source) | é›²ç«¯ç‰ˆ / ä¼æ¥­ç‰ˆ (Hosted / Enterprise) |
| --- | --- | --- |
| **Agent æ¡†æ¶æ•´åˆ** | âœ… (Autogen, CrewAI ç­‰) | âœ… |
| **æ—¥èªŒèˆ‡è¿½è¹¤ (Logging & Tracing)** | âš ï¸ (åƒ…é™æœ¬åœ°æ—¥èªŒ) | **âœ… (é€²éš Agent è¿½è¹¤)** |
| **è§€æ¸¬æ€§ (Observability)** | âŒ | **âœ… (å°ˆå±¬ Agent ç›£æ§å·¥å…·)** |

5\. éƒ¨ç½²èˆ‡æŠ€è¡“æ”¯æ´

é–‹æºç‰ˆå´é‡æ–¼ç¤¾ç¾¤é©…å‹•ï¼Œè€Œä¼æ¥­ç‰ˆå‰‡å°ˆæ³¨æ–¼ç§æœ‰åŒ–èˆ‡å°ˆæ¥­æœå‹™ã€‚

| åŠŸèƒ½é …ç›® | é–‹æºç‰ˆ (Open Source) | ä¼æ¥­ç‰ˆ (Enterprise) |
| --- | --- | --- |
| **éƒ¨ç½²æ–¹å¼** | æœ¬åœ° (npx), Docker, Node.js | **ç§æœ‰é›² (AWS, Azure, GCP, K8s)** |
| **æŠ€è¡“æ”¯æ´** | ç¤¾ç¾¤è«–å£‡ã€GitHubã€é€±äº”ç¤¾ç¾¤é€šè©± | **24/7 å°ˆæ¥­æ”¯æ´ã€åŠŸèƒ½å„ªå…ˆé–‹ç™¼æ¬Š** |
| **æˆæ¬Šå”è­°** | MIT æˆæ¬Š | ä¼æ¥­æˆæ¬Š |

--------------------------------------------------------------------------------

 **æ¯”å–»èªªæ˜ï¼š**    **é–‹æºç‰ˆ** å°±åƒæ˜¯æä¾›ä½ ä¸€çµ„ **å¼·å¤§çš„å¼•æ“èˆ‡æ–¹å‘ç›¤** ï¼ˆæ ¸å¿ƒè·¯ç”±èˆ‡å¯é æ€§ï¼‰ï¼Œè®“ä½ èƒ½è‡ªå·±çµ„è£å‡ºä¸€å°æ€§èƒ½æ¥µä½³çš„è³½è»Šã€‚è€Œ **é›²ç«¯ç‰ˆèˆ‡ä¼æ¥­ç‰ˆ** å‰‡æ˜¯åœ¨è³½è»ŠåŸºç¤ä¸ŠåŠ è£äº† **å…¨è‡ªå‹•å·¡èˆªç³»çµ±** ï¼ˆä¾›æ‡‰å•†å„ªåŒ–ï¼‰ã€ **é«˜ç§‘æŠ€é˜²ç›œé–èˆ‡è£ç”²** ï¼ˆPII è„«æ•èˆ‡å®‰å…¨åˆè¦ï¼‰ï¼Œä¸¦é™„å¸¶ä¸€çµ„ **å°ˆæ¥­ç¶­ä¿®è»ŠéšŠ** ï¼ˆ24/7 æ”¯æ´ï¼‰ï¼Œè®“ä½ åœ¨ä¼æ¥­ç´šçš„å•†æ¥­è³½é“ä¸Šè·‘å¾—æ—¢å®‰å…¨åˆé«˜æ•ˆã€‚

---

## è©•ä¼°åŠåˆ†æå¯è¡Œæ€§ã€‚
- å¸Œæœ›å°‡ https://github.com/Portkey-AI/gateway åŠŸèƒ½ åˆé€²è‡³ https://github.com/jeff-cheng101/Across-AI ä¸­ã€‚

### å®‰è£æ–¹æ³•

### A. Dockerï¼ˆæœ€ç›´æ¥ï¼‰

- ä»¥å®˜æ–¹ Docker image å•Ÿå‹•ï¼ˆé è¨­å°å¤–åŸ  8787ï¼‰ [hub.docker.com](https://hub.docker.com/r/portkeyai/gateway?utm_source=chatgpt.com)

    - `docker run -d -p 8787:8787 portkeyai/gateway:latest`
    - `docker run --rm -p 8787:8787 portkeyai/gateway:latest`

### B. Docker Compose

- ä¸‹è¼‰ repo çš„ compose æª”ä¸¦å•Ÿå‹• [hub.docker.com](https://hub.docker.com/r/portkeyai/gateway?utm_source=chatgpt.com)

    - `wget "https://raw.githubusercontent.com/Portkey-AI/gateway/main/docker-compose.yaml"`
    - `docker compose up -d`

### C. NPM å¥—ä»¶ï¼ˆä½œç‚ºç¨‹å¼å…§ä¾è³´/SDK æˆ– gateway å¥—ä»¶å½¢æ…‹ï¼‰

- NPM ä¸Šå­˜åœ¨ `@portkey-ai/gateway`ï¼Œé¡¯ç¤ºå¯ç”¨æ–¼å°ˆæ¡ˆä¾è³´ï¼›ç‰ˆæœ¬è³‡è¨Šèˆ‡ OpenAI ç›¸å®¹æ€§åœ¨é é¢å¯æŸ¥ã€‚

### WebUI

- http://localhost:8787/public/

---

### æ¸¬è©¦ç¯„ä¾‹

- test request
  
```json
curl -X POST \
      http://localhost:8787/v1/chat/completions \
      -H "Content-Type: application/json" \
      -H "x-portkey-provider: [Click to edit]" \
      -H "Authorization: [Click to edit]" \
      -d '{
        "messages": [
            { "role": "user", "content": "Hello, how are you?" }
        ],
        "model": """"
      }'
```

- å…§å®¹ç¯„ä¾‹

```json
{
    "messages": [
        { 
            "role": "user", 
            "content": "Hello, how are you?" 
        }
    ],
    "model": "gemini-2.5-flash"
}
```

- Response

```json
{
    "id": "portkey-644d57db-5a07-434d-8c93-14235d1f0e41",
    "object": "chat.completion",
    "created": 1767843275,
    "model": "gemini-2.5-flash",
    "provider": "google",
    "choices": [
        {
            "message": {
                "role": "assistant",
                "content": "Hello! As an AI, I don't have feelings in the way humans do, but I'm functioning perfectly and ready to assist you.\n\nHow are you doing today?"
            },
            "index": 0,
            "finish_reason": "stop"
        }
    ],
    "usage": {
        "prompt_tokens": 7,
        "completion_tokens": 37,
        "total_tokens": 190,
        "completion_tokens_details": {
            "reasoning_tokens": 146,
            "audio_tokens": 0
        },
        "prompt_tokens_details": {
            "cached_tokens": 0,
            "audio_tokens": 0
        }
    }
}
```

- é‡æ¸¬logç´€éŒ„
![åœ–](./GateWay_01.png)

---

## 2026/01/08 å¯¦é©—

https://github.com/jeff-cheng101/Across-AI/tree/feature/AI-GateWay

### Planner Response

ä»¥ä¸‹æ˜¯æœ¬æ¬¡ä¿®æ”¹çš„è©³ç´°èªªæ˜ä»¥åŠè¨­å®šå•Ÿå‹•æ­¥é©Ÿï¼š

### ğŸ“ ä¿®æ”¹å…§å®¹è§£è­¯

1.  **æ–°å¢ [backend/docker-compose.yml](cci:7://file:///c:/work/TW/Across-AI/backend/docker-compose.yml:0:0-0:0)**
    *   é€™æ˜¯ç”¨ä¾†åœ¨æœ¬åœ°å•Ÿå‹• **Portkey AI Gateway** çš„è¨­å®šæª”ã€‚
    *   å®ƒæœƒä¸‹è¼‰ä¸¦åŸ·è¡Œ `portkeyai/gateway:latest` æ˜ åƒæª”ï¼Œä¸¦å°‡æœå‹™é–‹å•Ÿåœ¨ `8787` portã€‚

2.  **ä¿®æ”¹ [backend/.env.example](cci:7://file:///c:/work/TW/Across-AI/backend/.env.example:0:0-0:0)**
    *   æ–°å¢äº† Portkey ç›¸é—œçš„ç’°å¢ƒè®Šæ•¸è¨­å®šç¯„æœ¬ï¼ŒåŒ…å«é–‹é—œ (`USE_PORTKEY`)ã€Gateway ç¶²å€ä»¥åŠ Ollama çš„é€£ç·šä½ç½®ã€‚

3.  **ä¿®æ”¹ [backend/services/trendAnalysisService.js](cci:7://file:///c:/work/TW/Across-AI/backend/services/trendAnalysisService.js:0:0-0:0)**
    *   åœ¨ [performAIAnalysis](cci:1://file:///c:/work/TW/Across-AI/backend/services/trendAnalysisService.js:1128:2-1299:3) å‡½å¼ä¸­åŠ å…¥åˆ¤æ–·é‚è¼¯ã€‚
    *   å¦‚æœ `USE_PORTKEY=true`ï¼Œç¨‹å¼æœƒå°‡ AI è«‹æ±‚ç¶²å€ (Base URL) æ”¹ç‚ºæŒ‡å‘ Portkey Gatewayã€‚
    *   è‡ªå‹•æ³¨å…¥ Portkey æ‰€éœ€çš„ Headers (å¦‚ `x-portkey-provider`, `x-portkey-custom-host`)ï¼Œè®“ Gateway çŸ¥é“è¦å°‡è«‹æ±‚è½‰ç™¼çµ¦ Gemini é‚„æ˜¯æœ¬åœ°çš„ Ollamaã€‚

---

### âš™ï¸ å°ˆæ¡ˆè¨­å®šèˆ‡å•Ÿå‹•æ­¥é©Ÿ

è«‹ä¾ç…§ä»¥ä¸‹æ­¥é©Ÿå•Ÿç”¨ Portkey Gateway åŠŸèƒ½ï¼š

#### 1. å•Ÿå‹• Portkey Gateway (Docker)

è«‹åœ¨ `backend` è³‡æ–™å¤¾ä¸‹é–‹å•Ÿçµ‚ç«¯æ©Ÿï¼ŒåŸ·è¡Œï¼š

```bash
docker-compose up -d
```

é€™æœƒä»¥å¾Œå°æ¨¡å¼å•Ÿå‹• Portkey Gatewayã€‚ä½ å¯ä»¥é€éç€è¦½å™¨è¨ªå• `http://localhost:8787/v1/health` ç¢ºèªå®ƒæ˜¯å¦æ­£å¸¸é‹ä½œã€‚

#### 2. è¨­å®šç’°å¢ƒè®Šæ•¸ (.env)

è«‹æ‰“é–‹ä½ çš„ [backend/.env](cci:7://file:///c:/work/TW/Across-AI/backend/.env:0:0-0:0) æª”æ¡ˆï¼Œä¸¦åœ¨æœ€å¾Œé¢åŠ å…¥ä»¥ä¸‹è¨­å®šï¼š

```properties
# Portkey Gateway è¨­å®š
USE_PORTKEY=true
PORTKEY_GATEWAY_URL=http://localhost:8787/v1
# è®“ Docker å…§çš„ Portkey èƒ½é€£åˆ°ä½ ä¸»æ©Ÿä¸Šçš„ Ollama
PORTKEY_OLLAMA_HOST=http://host.docker.internal:11434
```

> **æ³¨æ„**ï¼š`host.docker.internal` æ˜¯è®“ Docker å®¹å™¨é€£ç·šå›ä¸»æ©Ÿ (Host) çš„ç‰¹æ®Šç¶²å€ï¼Œé©ç”¨æ–¼ Windows å’Œ Macã€‚

#### 3. é‡å•Ÿå¾Œç«¯æœå‹™

ä¿®æ”¹å®Œ [.env](cci:7://file:///c:/work/TW/Across-AI/backend/.env:0:0-0:0) å¾Œï¼Œè«‹é‡æ–°å•Ÿå‹•ä½ çš„å¾Œç«¯ä¼ºæœå™¨ (ä¾‹å¦‚ run `npm run dev` æˆ– `node index.js`)ï¼Œè®“æ–°çš„ç’°å¢ƒè®Šæ•¸ç”Ÿæ•ˆã€‚

#### 4. é©—è­‰

ç•¶ä½ è§¸ç™¼ AI åˆ†æåŠŸèƒ½æ™‚ï¼š
- **å¾Œç«¯ Log** æœƒé¡¯ç¤ºï¼š`API URL: http://localhost:8787/v1 (via Portkey Gateway)`ã€‚
- **Portkey Log** (å¯ç”¨ `docker-compose logs -f` æŸ¥çœ‹) æœƒé¡¯ç¤ºè«‹æ±‚å·²é€²å…¥ Gateway ä¸¦è½‰ç™¼ã€‚

é€™æ¨£å°±å®Œæˆäº†ï¼ä¹‹å¾Œæ‰€æœ‰çš„ AI è«‹æ±‚éƒ½æœƒç¶“é Portkeyï¼Œä½ å¯ä»¥åœ¨ Gateway ä¸Šé€²è¡Œç›£æ§èˆ‡ç´€éŒ„ã€‚

## å¦‚æœæ˜¯ç™¼çµ¦ dify æ‰€ç™¼ä½ˆçš„ api æ¥å£ï¼Œgateway ä¸€æ¨£å‘¢æŠ“åˆ°ä¸¦ç´€éŒ„å—ï¼Ÿ

### Planner Response

Portkey æ”¯æ´é€é **OpenAI-Compatible** çš„æ–¹å¼ä¾†ä»£ç†ä»»ä½•ç›¸å®¹ OpenAI ä»‹é¢çš„æœå‹™ï¼Œè€Œ **Dify** å‰›å¥½æ”¯æ´ OpenAI ç›¸å®¹çš„ API è¼¸å‡ºã€‚

å› æ­¤ï¼Œ**å¯ä»¥**é€é Gateway åµæ¸¬åŠç´€éŒ„ç™¼çµ¦ Dify çš„è«‹æ±‚ã€‚

### å¦‚ä½•è¨­å®š

è¦åœ¨ Portkey ç´€éŒ„ Dify çš„è«‹æ±‚ï¼ŒåŸç†å°±åƒæˆ‘å€‘å‰›å‰›è¨­å®š Ollama ä¸€æ¨£ï¼ŒæŠŠ Dify ç•¶ä½œä¸€å€‹ã€Œè‡ªå®šç¾©çš„ OpenAI Providerã€ã€‚

#### 1. ç¢ºèª Dify API è³‡è¨Š
ä½ éœ€è¦æº–å‚™å¥½ Dify çš„ API URL å’Œ API Keyï¼š
*   **Dify Base URL**: é€šå¸¸æ˜¯ `http://<dify-host>/v1` (è«‹ç¢ºèª Dify æœ‰é–‹å•Ÿ OpenAI ç›¸å®¹ä»‹é¢)
*   **Dify API Key**: ä½ çš„ Dify App API Key

#### 2. ç¨‹å¼ç¢¼ä¿®æ”¹ç¯„ä¾‹
åœ¨ä½ çš„ç¨‹å¼ç¢¼ä¸­ï¼Œè¨­å®š Headers è®“ Portkey çŸ¥é“è¦æŠŠè«‹æ±‚è½‰ç™¼çµ¦ Difyï¼š

```javascript
// åœ¨ä½ çš„ trendAnalysisService.js æˆ–å…¶ä»–å‘¼å«é»

const usePortkey = process.env.USE_PORTKEY === 'true';
// Dify çš„ä½å€ (è‹¥åœ¨ Docker å…§äº’é€£è«‹ç”¨ host.docker.internal æˆ–çœŸå¯¦ IP)
const difyUrl = 'http://host.docker.internal:5001/v1'; 

const completion = await openai.chat.completions.create({
  model: 'your-dify-model-name', // Dify ä¸Šå°æ‡‰çš„æ¨¡å‹åç¨±
  messages: messages,
}, {
  // é€é Portkey Gateway
  baseURL: usePortkey ? 'http://localhost:8787/v1' : difyUrl,
  headers: usePortkey ? {
    'x-portkey-provider': 'openai', // é€™è£¡ trick æ˜¯ç”¨ 'openai' æˆ– 'custom'
    'x-portkey-custom-host': difyUrl, // å‘Šè¨´ Gateway è½‰ç™¼ç›®æ¨™æ˜¯ Dify
    'Authorization': `Bearer ${difyApiKey}` // ä½ çš„ Dify Key
  } : {}
});
```

### é—œéµé»
*   **`x-portkey-custom-host`**: é€™æ˜¯é—œéµ Headerï¼Œå‘Šè¨´ Portkey ä¸è¦å»é€£çœŸçš„ OpenAIï¼Œè€Œæ˜¯é€£åˆ°ä½ æŒ‡å®šçš„ Dify URLã€‚
*   **ä»‹é¢ç›¸å®¹æ€§**: åªè¦ Dify çš„å›æ‡‰æ ¼å¼ç¬¦åˆ OpenAI Chat Completion æ ¼å¼ (å¤§éƒ¨åˆ†éƒ½ç¬¦åˆ)ï¼ŒPortkey å°±èƒ½æˆåŠŸè§£æä¸¦åœ¨ Dashboard ä¸Šé¡¯ç¤º token æ•¸ã€è€—æ™‚å’Œå®Œæ•´å…§å®¹ã€‚

é€™æ¨£ä¸€ä¾†ï¼Œä½ çš„å¾Œç«¯ä¸ç®¡æ˜¯ç™¼çµ¦ **Gemini**ã€**Ollama** é‚„æ˜¯ **Dify**ï¼Œå…¨éƒ¨éƒ½èƒ½åœ¨ Portkey çš„çµ±ä¸€ä»‹é¢ä¸Šçœ‹åˆ°ç´€éŒ„ï¼